---
title: "TidyTuesday - UN Votes"
author: "Moriah Taylor"
date: "3/23/2021"
output: html_document
---

# This Week's Data

The data this week comes from Harvard's Dataverse by way of Mine Çetinkaya-Rundel, David Robinson, and Nicholas Goguen-Compagnoni.

Original Data citation:

Citation: Erik Voeten "Data and Analyses of Voting in the UN General Assembly" Routledge Handbook of International Organization, edited by Bob Reinalda (published May 27, 2013). Available at SSRN: http://ssrn.com/abstract=2111149

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE, include=TRUE}
library(tidytuesdayR)
library(tidyverse)
library(lubridate)
library(ggdark)
library(unvotes)
library(extrafont)
```


# Load the Data

Download this week's data on UN Voting utilizing code made available on the TidyTuesday GitHub.
```{r, message=FALSE, warning=FALSE, include=TRUE}
# Get the Data
# Code sourced from TidyTuesday GitHub
# (https://github.com/rfordatascience/tidytuesday/tree/master/data/2021/2021-03-23)

unvotes <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-23/unvotes.csv')
roll_calls <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-23/roll_calls.csv')
issues <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-23/issues.csv')
```

# Data Cleaning

The data cleaning can be found in the [data-raw](https://github.com/dgrtwo/unvotes/blob/master/data-raw/un-data.R) folder of the package. 

```{r, message=FALSE, warning=FALSE, include=TRUE}
library(dplyr)
library(readxl)
library(countrycode)
library(tidyr)
library(forcats)

vlevels <- c("yes", "abstain", "no")

load("UNVotes2021.RData")

un_votes <- completeVotes %>%
  filter(vote <= 3) %>%
  mutate(
    country = countrycode(ccode, "cown", "country.name"),
    country_code = countrycode(ccode, "cown", "iso2c"),
    # Match based on old version of data from unvotes package
    country_code = case_when(
      country == "Czechoslovakia" ~ "CS",
      country == "Yugoslavia" ~ "YU",
      country == "German Democratic Republic" ~ "DD",
      country == "Yemen People's Republic" ~ "YD",
      TRUE ~ country_code
    ),
    country = if_else(!is.na(Countryname) & Countryname == "German Federal Republic", "Federal Republic of Germany", country)
  ) %>%
  select(rcid, country, country_code, vote) %>%
  mutate(vote = as.character(vote)) %>%
  mutate(vote = fct_recode(vote, yes = "1", abstain = "2", no = "3"))

descriptions <- completeVotes %>%
  select(session, rcid, abstain, yes, no, importantvote, date, unres, amend, para, short, descr, me, nu, di, hr, co, ec) %>%
  distinct(rcid, .keep_all = TRUE)

un_roll_calls <- descriptions %>%
  select(rcid, session, importantvote:descr) %>%
  mutate(rcid = as.integer(rcid),
         date = as.Date(date)) %>%
  arrange(rcid)

un_roll_call_issues <- descriptions %>%
  select(rcid, me:ec) %>%
  gather(short_name, value, me:ec) %>%
  mutate(rcid = as.integer(rcid),
         value = as.numeric(value)) %>%
  filter(value == 1) %>%
  select(-value) %>%
  mutate(issue = fct_recode(short_name,
                            "Palestinian conflict" = "me",
                            "Nuclear weapons and nuclear material" = "nu",
                            "Colonialism" = "co",
                            "Human rights" = "hr",
                            "Economic development" = "ec",
                            "Arms control and disarmament" = "di"))
```

# Data Exploration

```{r, message=FALSE, warning=FALSE, include=TRUE}
#find out what kinds of issues are voted on
unique(un_roll_call_issues$issue)
```

```{r, message=FALSE, warning=FALSE, include=TRUE}
#total votes per country
votes_per_country = aggregate(x=as.numeric(un_votes$vote), by=list(un_votes$country), FUN=sum)

#filter to this millenium
##first must determine which roll call ids relate to issues dating from 2000 and later
un_roll_calls$year = format(as.Date(un_roll_calls$date, format="%d/%m/%Y"),"%Y")
un_roll_calls$month = format(as.Date(un_roll_calls$date, format="%d/%m/%Y"),"%m")
un_roll_calls$day = format(as.Date(un_roll_calls$date, format="%d/%m/%Y"),"%d")
recent_un_roll_calls = subset(un_roll_calls, un_roll_calls$year >= 2000)
min_rcid = min(recent_un_roll_calls$rcid)
max_rcid = max(recent_un_roll_calls$rcid)
##now can filter votes
recent_un_votes = subset(un_votes, rcid >= min_rcid & rcid <= max_rcid)

#total votes per country in recent years
recent_votes_per_country = aggregate(x=as.numeric(recent_un_votes$vote), by=list(recent_un_votes$country), FUN=sum)

#determine biggest players (countries who have voted the most)
biggest_players <- recent_votes_per_country %>% slice_max(order_by = x, n = 8)
top_countries = list(biggest_players$Group.1)
```

```{r, message=FALSE, warning=FALSE, include=TRUE}
#get rcids for nuclear issues from un_roll_call_issues
nuclear_subset <- subset(un_roll_call_issues, short_name=="nu")
nuclear_rcids <- unique(nuclear_subset$rcid)

#subset un_roll_calls to only nuclear issues
nuclear_roll_calls = subset(un_roll_calls, rcid %in% nuclear_rcids)

#subset nuclear_roll_calls to cold war period
cold_war = subset(nuclear_roll_calls, year>=1947 & year<=1991)


```

```{r, message=FALSE, warning=FALSE, include=TRUE}
cold_war_nuclear_issues <- cold_war %>%
  group_by(date) %>%
  mutate(count_issues = length(unique(rcid))) %>%
  mutate(month_decimal = as.numeric(month) * 0.08) %>%
  mutate(x_axis = as.numeric(year) + month_decimal) %>%
  select(date, year, month, day, count_issues, x_axis)
```

```{r, message=FALSE, warning=FALSE, include=TRUE}
#load fonts
loadfonts()
```

```{r, message=FALSE, warning=FALSE, include=TRUE}
#create visualization
ggplot(cold_war_nuclear_issues, aes(x=x_axis, y=count_issues, ymax=count_issues)) +
  #geom_ribbon(y=count_issues, ymin=0, ymax=19, color = '#D25c07') + #color="black", fill = '#D25c07'
  #geom_area(aes(fill='#D25c07')) +
  #geom_line(aes(color='#D25c07')) +
  geom_ribbon(ymin=-1, fill='#D25c07', alpha=0.5) +
  scale_x_continuous(
    breaks = seq(1948, 1990, 3),
    labels = paste0(seq(1948, 1990, 3)),
    limits = c(1948.56, 1991.16)
  ) +
  scale_y_continuous(
    breaks = seq(0,20,2),
    labels = paste0(seq(0,20,2)),
    limits = c(1,20),
  ) +
  labs(
    title = "Going Nuclear",
    subtitle = "Number of Nuclear Issues Addressed in UN sessions during the Cold War",
    caption = "Made by Moriah Taylor, with UN Votes data"
  ) +
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.x = element_text(color = "#000000", size = 14),
    axis.text.y = element_text(color = "#000000", size = 14),
    axis.ticks = element_blank(),
    panel.background = element_rect(fill = "#dadbde"),
    plot.background = element_rect(fill = "#dadbde"),
    panel.grid.major = element_line(color = "#848690"),
    panel.grid.minor = element_blank(),
    axis.line = element_line(color = "#848690"),
    plot.title = element_text(hjust = 0.5, color = "#7e2b04", size = 25),
    plot.subtitle = element_text(hjust = 0.5, color = "#7e2b04", size = 18),
    plot.caption = element_text(color = "#3f1602", size = 12),
    text = element_text(family = "Bahnschrift")

  ) 

```

```{r, message=FALSE, warning=FALSE, include=TRUE}

```

```{r, message=FALSE, warning=FALSE, include=TRUE}

```

```{r, message=FALSE, warning=FALSE, include=TRUE}

```

```{r, message=FALSE, warning=FALSE, include=TRUE}

```

```{r, message=FALSE, warning=FALSE, include=TRUE}

```

```{r, message=FALSE, warning=FALSE, include=TRUE}

```

```{r, message=FALSE, warning=FALSE, include=TRUE}

```

```{r, message=FALSE, warning=FALSE, include=TRUE}

```

```{r, message=FALSE, warning=FALSE, include=TRUE}

```

```{r, message=FALSE, warning=FALSE, include=TRUE}

```

```{r, message=FALSE, warning=FALSE, include=TRUE}

```

----------------------------------

#### TidyTuesday

Join the R4DS Online Learning Community in the weekly #TidyTuesday event!
Every week we post a raw dataset, a chart or article related to that dataset, and ask you to explore the data.
While the dataset will be “tamed”, it will not always be tidy! As such you might need to apply various R for Data Science techniques to wrangle the data into a true tidy format.
The goal of TidyTuesday is to apply your R skills, get feedback, explore other’s work, and connect with the greater #RStats community!
As such we encourage everyone of all skills to participate!